# Auth


## Original
1. launcher authenticates user
2. launcher opens aion
3. aion client connects to windows pipe \\.\pipe\GameforgeClientJSONRPC
4. aion client recieves from pipe converation:
  * locale e.g. "en-GB"
  * Authorization Code (THE PROOF WE ARE WHO WE SAY WE ARE)
  * Account Name (account name)
  * Account Id (account id)
5. TODO: aion client connects to Auth Server
6. aion client connects to STS Server
7. client -> server /Sts/Connect
8. client -> server /StsLoginTokenStart - ClientRand
9. server -> client - ServerRand, PublicKey
10. client -> server /Auth/TokenKeyData - Algorithm, Key, PremasterSecret, AuthnToken 
11. server now parses AuthnToken and intialises an RC4 stream based on the cryptographic exchange
13. server -> client - RC4 Encrypted 200 OK, all future messages are encrypted
14. client -> server /Auth/LoginFinish
15. client -> server /Auth/RequestToken
16. server -> client AuthnToken (username:password???)
...

17. client -> game server - HqLogin 2x 4 byte id's and the authn_token generated by STS

## Authn Token

Authn Token is authentication information that has been encrypted by the aion client and sent to the STS server

* locale
* auth_data - from the gameforge launcher (hex string of json object)
```json
{
    "account_display_name":"{Account Name}",
    "auth_ticket":"{Authorization Code}",
    "auth_type":"gf",
    "external_account_id":0
}
```

## Ours
1. Our launcher authenticates user using OAuth device flow that returns JWT

